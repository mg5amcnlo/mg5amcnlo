# Environment variables

ifeq ($(origin FFLAGS),undefined)
  FFLAGS= -O -w -fbounds-check -fPIC
  #FFLAGS+= -g -fbounds-check -ffpe-trap=invalid,zero,overflow,underflow,denormal -Wall
endif

ifdef f2pymode
    MACFLAG= 
else
    MACFLAG= -mmacosx-version-min=10.7
endif


ifeq ($(origin CXXFLAGS),undefined)
  #CXXFLAGS= -g 
  CXXFLAGS= -O -stdlib=libc++ $(MACFLAG)
endif

ifeq ($(origin CFLAGS),undefined)
  #CFLAGS= -g 
  CFLAGS= -O -stdlib=libc++ $(MACFLAG)
endif

# Increase the number of allowed charcters in a Fortran line
FFLAGS+= -ffixed-line-length-132

# Set FC unless it's defined by an environment variable
ifeq ($(origin FC),default)
   FC=gfortran
endif
ifeq ($(origin F2PY), undefined)
   F2PY=f2py
endif

UNAME := $(shell uname -s)
ifeq ($(origin LDFLAGS), undefined)
LDFLAGS=-lstdc++
endif

# Options: dynamic, lhapdf
# Option dynamic

ifeq ($(UNAME), Darwin)
  dylibext=dylib
else
  dylibext=so  
endif

ifdef dynamic
  ifeq ($(UNAME), Darwin)
    libext=dylib
    FFLAGS+= -fno-common
    LDFLAGS += -bundle
    define CREATELIB
      $(FC) -dynamiclib -undefined dynamic_lookup -o $(1) $(2)
    endef
  else
    libext=so
    FFLAGS+= -fPIC
    LDFLAGS += -shared
    define CREATELIB
      $(FC) $(FFLAGS) $(LDFLAGS) -o $(1) $(2)
    endef
  endif
else
  libext=a
  define CREATELIB
    $(AR) cru $(1) $(2)
    ranlib $(1)
  endef
endif

# Option lhapdf

ifdef lhapdf
  CXXFLAGS += $(shell $(lhapdf) --cppflags)
  alfas_functions=alfas_functions_lhapdf
  llhapdf+= -lLHAPDF
else
  alfas_functions=alfas_functions
  llhapdf=
endif
